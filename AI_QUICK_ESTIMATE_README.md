# AI快速评估功能说明

## 功能概述

AI快速评估功能是软件成本评估看板的智能化功能，通过集成DeepSeek AI，可以根据项目基本信息自动生成详细的需求清单，大幅提升需求分析和成本评估的效率。

## 核心特性

### 1. 智能提示词生成
- 根据项目名称、描述、行业应用、交付端自动生成专业的AI提示词
- 提示词包含完整的输出格式要求和示例
- 自动复制到剪贴板，一键粘贴使用

### 2. 无缝AI集成
- 自动跳转到DeepSeek AI聊天界面
- 3秒倒计时，给用户准备时间
- 可随时跳过等待，直接进入下一步

### 3. 结果智能解析
- 支持多种JSON格式识别（代码块、纯JSON等）
- 自动验证数据完整性和格式正确性
- 智能容错，自动填充默认值
- 详细的错误提示，帮助用户定位问题

### 4. 一键导入
- 解析DeepSeek生成的JSON结果
- 自动生成唯一ID和必要字段
- 保留原有数据，追加新模块
- 导入成功后显示统计信息

## 技术实现

### 组件结构

```
components/
  └── quick-estimate-dialog.tsx    # 快速评估对话框主组件
```

### 关键功能

#### 1. 提示词生成
```typescript
const generatePrompt = () => {
  // 基于projectInfo生成结构化提示词
  // 包含项目信息、输出要求、JSON格式示例
}
```

#### 2. JSON解析
```typescript
const parseResult = (text: string): FunctionNode[] | null => {
  // 1. 提取JSON（支持多种格式）
  // 2. 验证数据结构
  // 3. 添加ID和默认值
  // 4. 递归处理子节点
  // 5. 错误处理和用户反馈
}
```

#### 3. 数据导入
```typescript
const handleImport = () => {
  // 1. 解析输入文本
  // 2. 验证结果
  // 3. 统计节点数量
  // 4. 调用回调函数导入
  // 5. 显示成功提示
}
```

### 数据格式

#### 输入格式（DeepSeek返回）
```json
[
  {
    "name": "模块名称",
    "complexity": "低|中|高|很高",
    "priority": "低|中|高|很高",
    "isImportant": true|false,
    "remark": "详细说明",
    "children": [
      {
        "name": "子功能",
        "complexity": "中",
        "priority": "高",
        "isImportant": false,
        "remark": "功能说明"
      }
    ]
  }
]
```

#### 输出格式（FunctionNode）
```typescript
interface FunctionNode {
  id: string;                    // 自动生成的唯一ID
  name: string;                  // 功能名称
  complexity?: Complexity;       // 复杂度
  priority?: Priority;           // 优先级
  isImportant: boolean;          // 是否重要
  remark: string;                // 备注说明
  children?: FunctionNode[];     // 子节点
  parentId?: string;             // 父节点ID
}
```

## 使用流程

### 步骤1：准备项目信息
在顶部导航栏填写：
- 项目名称
- 项目描述
- 行业应用
- 交付端

### 步骤2：点击快速评估
点击左侧功能树面板的"快速评估"按钮（⚡图标）

### 步骤3：等待跳转
- 系统自动复制提示词
- 3秒倒计时后自动打开DeepSeek
- 可点击"跳过等待"直接进入

### 步骤4：使用DeepSeek
1. 在DeepSeek中粘贴提示词
2. 等待AI生成结果
3. 复制JSON格式的返回内容

### 步骤5：导入结果
1. 返回系统对话框
2. 粘贴DeepSeek的返回内容
3. 点击"导入"按钮
4. 查看导入成功提示

## 错误处理

### 常见错误及解决方案

#### 1. "未找到有效的JSON数据"
**原因**：输入内容不包含有效的JSON格式
**解决**：
- 检查是否完整复制了DeepSeek的返回内容
- 确保包含 `[...]` 数组格式
- 可以只复制 ```json ``` 代码块内的内容

#### 2. "数据格式错误：期望数组格式"
**原因**：JSON格式正确，但不是数组
**解决**：
- 确保最外层是数组 `[...]`
- 如果只有一个对象，也要用数组包裹 `[{...}]`

#### 3. "节点缺少必需的name字段"
**原因**：某些节点没有name字段
**解决**：
- 检查JSON中每个节点是否都有name字段
- 补充缺失的name字段

#### 4. 复杂度或优先级不在有效范围内
**处理**：系统自动设置为默认值"中"
**说明**：有效值为：低、中、高、很高

## 优化建议

### 1. 提示词优化
- 提供更详细的项目描述，AI生成结果更准确
- 明确行业特点，获得更贴合的功能模块
- 指定交付端，获得针对性的技术建议

### 2. 结果调整
- 导入后可以在功能树中手动调整
- 可以添加、删除、重命名节点
- 可以调整复杂度、优先级、重要性

### 3. 多次使用
- 可以多次使用快速评估功能
- 每次导入都会追加到现有数据
- 建议先评估核心模块，再细化子功能

## 最佳实践

### 1. 项目信息准备
```
项目名称：在线教育平台
项目描述：面向K12的在线教育平台，支持直播授课、录播课程、在线作业、学习报告等功能
行业应用：教育
交付端：Web端、H5、Android端、IOS端
```

### 2. 提示词使用
- 直接使用系统生成的提示词
- 如有特殊需求，可以手动修改提示词后再发送给AI
- 可以在DeepSeek中追问，要求AI补充更多细节

### 3. 结果处理
- 先快速浏览生成结果是否符合预期
- 导入前可以在文本编辑器中预先调整
- 导入后在系统中进行精细化编辑

### 4. 迭代优化
- 第一次使用：生成基础模块框架
- 第二次使用：针对某个模块深入展开
- 手动补充：添加特殊需求和细节

## 技术细节

### 1. ID生成策略
```typescript
// 顶层节点
`node-${Date.now()}-${randomString}-${index}`

// 子节点
`${parentId}-${index}`
```

### 2. 容错机制
- 自动补充缺失的必填字段
- 验证并修正无效的枚举值
- 过滤空的children数组
- 捕获并提示所有解析错误

### 3. 状态管理
```typescript
// 三个主要状态
'generating'  // 生成提示词并倒计时
'waiting'     // 跳转DeepSeek
'input'       // 等待用户输入结果
```

### 4. 用户体验优化
- 自动复制，减少手动操作
- 倒计时提示，给用户准备时间
- 实时字符计数，显示输入进度
- 详细的成功/失败反馈

## 示例文件

项目中包含示例文件 `example-deepseek-response.json`，展示了一个完整的电商系统需求清单，包含：
- 5个顶层模块
- 21个功能菜单
- 完整的复杂度和优先级评估
- 详细的功能说明

可以将此文件内容复制到对话框中测试导入功能。

## 未来改进方向

1. **AI模型集成**
   - 支持更多AI服务（GPT、文心一言等）
   - 内置AI调用，无需跳转外部网站

2. **提示词模板**
   - 针对不同行业提供专业模板
   - 支持用户自定义提示词模板

3. **智能推荐**
   - 基于历史数据推荐相似项目的需求
   - 自动补全常见功能模块

4. **批量操作**
   - 支持一次导入多个项目
   - 支持导出为标准格式供AI训练

5. **协作功能**
   - 分享AI生成的提示词
   - 复用他人的优质需求模板

## 总结

AI快速评估功能通过与DeepSeek AI的集成，显著提升了需求分析的效率和质量。用户只需提供基本的项目信息，即可在几分钟内获得一份结构化、专业化的需求清单，为后续的成本评估奠定坚实基础。

